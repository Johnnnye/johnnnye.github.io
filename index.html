<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>John Emslie – Sound Designer & Composer</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #fff;
      color: #111;
      overflow: hidden;
    }

    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .hero {
      position: absolute;
      top: 15%;
      width: 100%;
      text-align: center;
    }

    .hero h1 {
      font-size: 3rem;
      letter-spacing: 0.08em;
      animation: breathe 8s ease-in-out infinite;
    }

    .hero .role {
      margin-top: 0.5rem;
      opacity: 0.7;
    }

    @keyframes breathe {
      0%   { transform: scale(0.97); opacity: 0.6; }
      50%  { transform: scale(1.03); opacity: 1; }
      100% { transform: scale(0.97); opacity: 0.6; }
    }

    .categories {
      position: absolute;
      inset: 0;
    }

    .node {
      position: absolute;
      cursor: pointer;
      user-select: none;
    }

    .contact {
      position: absolute;
      bottom: 30px;
      width: 100%;
      text-align: center;
    }

    .contact a {
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.95);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hidden {
      display: none;
    }

    .overlay-content {
      max-width: 600px;
      text-align: center;
    }

    button {
      margin-top: 2rem;
    }
  </style>
</head>
<body>

<main class="container">

  <section class="hero">
    <h1 id="title">JOHN EMSLIE</h1>
    <p class="role">Sound Designer & Composer</p>
  </section>

  <section class="categories">
    <div class="node" data-note="146.83" style="top:32%; left:30%;">Picture</div>
    <div class="node" data-note="174.61" style="top:50%; left:62%;">Music</div>
    <div class="node" data-note="196.00" style="top:68%; left:40%;">Redesigns</div>
    <div class="node" data-note="220.00" style="top:78%; left:58%;">Games</div>
  </section>

  <footer class="contact">
    <a href="mailto:john@youremail.com" id="contact">john@youremail.com</a>
  </footer>

</main>

<script>
/* =========================
   AUDIO — SINGLE CONTEXT
========================= */

let ctx, master, reverb;
let unlocked = false;

/* ---------- UNLOCK ---------- */
function unlockAudio() {
  if (unlocked) return;

  ctx = new (window.AudioContext || window.webkitAudioContext)();

  master = ctx.createGain();
  master.gain.value = 0.25;
  master.connect(ctx.destination);

  reverb = ctx.createConvolver();
  const ir = ctx.createBuffer(2, ctx.sampleRate * 2, ctx.sampleRate);
  for (let c = 0; c < 2; c++) {
    const d = ir.getChannelData(c);
    for (let i = 0; i < d.length; i++) {
      d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (ctx.sampleRate * 0.6));
    }
  }
  reverb.buffer = ir;

  const revGain = ctx.createGain();
  revGain.gain.value = 0.22;
  reverb.connect(revGain);
  revGain.connect(master);

  buildBreath();
  buildNodes();
  buildContact();

  unlocked = true;
}

["mousedown","mousemove","keydown","touchstart"].forEach(e =>
  window.addEventListener(e, unlockAudio, { once: true })
);

/* =========================
   BREATH — LOCKED TO TITLE
========================= */

function buildBreath() {
  const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;

  const noise = ctx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;

  const filter = ctx.createBiquadFilter();
  filter.type = "bandpass";
  filter.frequency.value = 600;
  filter.Q.value = 0.8;

  const gain = ctx.createGain();
  gain.gain.value = 0;

  noise.connect(filter);
  filter.connect(gain);
  gain.connect(reverb);

  noise.start();

  const title = document.getElementById("title");
  const styles = getComputedStyle(title);
  const duration = parseFloat(styles.animationDuration) * 1000;
  const start = performance.now();

  function loop(now) {
    if (ctx.state !== "running") {
      requestAnimationFrame(loop);
      return;
    }
    const phase = ((now - start) % duration) / duration;
    const amp = Math.sin(phase * Math.PI);
    gain.gain.setTargetAtTime(Math.max(0, amp) * 0.06, ctx.currentTime, 0.3);
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
}

/* =========================
   NODES
========================= */

function buildNodes() {
  document.querySelectorAll(".node").forEach(el => {
    const osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = parseFloat(el.dataset.note);

    const gain = ctx.createGain();
    gain.gain.value = 0;

    osc.connect(gain);
    gain.connect(master);
    gain.connect(reverb);
    osc.start();

    el.addEventListener("mouseenter", () => {
      gain.gain.setTargetAtTime(0.06, ctx.currentTime, 1);
    });
    el.addEventListener("mouseleave", () => {
      gain.gain.setTargetAtTime(0, ctx.currentTime, 1.5);
    });
    el.addEventListener("click", clickSound);
  });
}

/* =========================
   CONTACT NODE (UNIQUE NOTE)
========================= */

function buildContact() {
  const el = document.getElementById("contact");

  const osc = ctx.createOscillator();
  osc.type = "sine";
  osc.frequency.value = 293.66; // extension tone

  const gain = ctx.createGain();
  gain.gain.value = 0;

  osc.connect(gain);
  gain.connect(master);
  gain.connect(reverb);
  osc.start();

  el.addEventListener("mouseenter", () => {
    gain.gain.setTargetAtTime(0.035, ctx.currentTime, 1.2);
  });
  el.addEventListener("mouseleave", () => {
    gain.gain.setTargetAtTime(0, ctx.currentTime, 2);
  });
  el.addEventListener("click", e => {
    e.preventDefault();
    clickSound();
    setTimeout(() => location.href = el.href, 120);
  });
}

/* =========================
   CLICK
========================= */

function clickSound() {
  if (!unlocked) return;
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type = "sine";
  osc.frequency.value = 140;
  const t = ctx.currentTime;
  gain.gain.setValueAtTime(0, t);
  gain.gain.linearRampToValueAtTime(0.06, t + 0.02);
  gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.5);
  osc.connect(gain);
  gain.connect(master);
  gain.connect(reverb);
  osc.start(t);
  osc.stop(t + 0.6);
}
</script>

</body>
</html>
