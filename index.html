<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>John Emslie – Sound Designer & Composer</title>

  <link rel="stylesheet" href="style.css">
</head>
<body>

<main class="container">

  <!-- HERO -->
  <section class="hero">
    <h1 id="title">JOHN EMSLIE</h1>
    <p class="role">Sound Designer & Composer</p>
  </section>

  <!-- NODES -->
  <section class="categories">
    <div class="node" data-note="146.83" style="top:32%; left:30%;">Picture</div>
    <div class="node" data-note="174.61" style="top:50%; left:62%;">Music</div>
    <div class="node" data-note="196.00" style="top:68%; left:40%;">Redesigns</div>
    <div class="node" data-note="220.00" style="top:78%; left:58%;">Games</div>
  </section>

  <!-- CONTACT -->
  <footer class="contact">
    <a href="mailto:john@youremail.com">john@youremail.com</a>
  </footer>

</main>

<script>
/* =========================
   AUDIO — SIMPLE & STABLE
========================= */

let ctx, master, reverb;
let unlocked = false;

/* ---------- UNLOCK ---------- */
function unlockAudio() {
  if (unlocked) return;

  ctx = new (window.AudioContext || window.webkitAudioContext)();

  master = ctx.createGain();
  master.gain.value = 0.25;
  master.connect(ctx.destination);

  reverb = ctx.createConvolver();
  const ir = ctx.createBuffer(2, ctx.sampleRate * 2, ctx.sampleRate);
  for (let c = 0; c < 2; c++) {
    const d = ir.getChannelData(c);
    for (let i = 0; i < d.length; i++) {
      d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (ctx.sampleRate * 0.6));
    }
  }
  reverb.buffer = ir;

  const revGain = ctx.createGain();
  revGain.gain.value = 0.2;
  reverb.connect(revGain);
  revGain.connect(master);

  buildBreath();
  buildNodes();

  unlocked = true;
}

["mousedown","mousemove","keydown","touchstart"].forEach(e =>
  window.addEventListener(e, unlockAudio, { once: true })
);

/* =========================
   BREATH — SYNCED TO TITLE
========================= */

function buildBreath() {
  const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;

  const noise = ctx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;

  const filter = ctx.createBiquadFilter();
  filter.type = "bandpass";
  filter.frequency.value = 600;
  filter.Q.value = 0.8;

  const gain = ctx.createGain();
  gain.gain.value = 0;

  noise.connect(filter);
  filter.connect(gain);
  gain.connect(reverb);
  noise.start();

  const title = document.getElementById("title");
  const styles = getComputedStyle(title);
  const duration = parseFloat(styles.animationDuration) * 1000;
  const start = performance.now();

  function loop(now) {
    if (ctx.state !== "running") {
      requestAnimationFrame(loop);
      return;
    }
    const phase = ((now - start) % duration) / duration;
    const amp = Math.sin(phase * Math.PI);
    gain.gain.setTargetAtTime(Math.max(0, amp) * 0.06, ctx.currentTime, 0.3);
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
}

/* =========================
   NODE TONES
========================= */

function buildNodes() {
  document.querySelectorAll(".node").forEach(el => {
    const osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = parseFloat(el.dataset.note);

    const gain = ctx.createGain();
    gain.gain.value = 0;

    osc.connect(gain);
    gain.connect(master);
    gain.connect(reverb);
    osc.start();

    el.addEventListener("mouseenter", () => {
      gain.gain.setTargetAtTime(0.06, ctx.currentTime, 1);
    });

    el.addEventListener("mouseleave", () => {
      gain.gain.setTargetAtTime(0, ctx.currentTime, 1.5);
    });
  });
}
</script>

</body>
</html>
